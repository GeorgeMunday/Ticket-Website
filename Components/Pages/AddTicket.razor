@page "/addticket"
@rendermode InteractiveServer
@inject HeaderService HeaderService
@inject AuthService AuthService
@inject NavigationManager NavManager

<PageTitle>Add Ticket</PageTitle>

@if (authState)
{
    <MudPaper Class="p-4" Elevation="4">
        <MudForm>
            <MudTextField T="string" Label="Ticket Name" Required="false" />
            <MudTextField T="string" Label="Description" Required="false" />
            <MudNumericField Label="Priority" Variant="Variant.Text" Min="0" Max="5" />
            <MudNumericField Label="Estimated Time (Hr)" Variant="Variant.Text" Min="0" Max="100" />
            <MudNumericField T="int" Label="Ticket ID" Disabled="true" Variant="Variant.Outlined" HideSpinButtons="true" />
            <MudButton>Submit</MudButton>
        </MudForm>
    </MudPaper>
}
else
{
    <MudPaper Class="pa-4">
        <MudText Typo="Typo.h5">You are not logged in</MudText>
        <MudText>Please waitâ€¦ navigating</MudText>
        <MudProgressLinear Indeterminate="true" Class="mt-2" />
    </MudPaper>
}

@code {
    bool authState;
    bool redirectStarted = false;

    protected override void OnInitialized()
    {
        HeaderService.Heading = "Add Ticket";
        authState = AuthService.AuthState;
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender && !authState && !redirectStarted)
        {
            redirectStarted = true;
            await Task.Delay(1000);
            NavManager.NavigateTo("/auth");
        }
    }
}